jQuery(document).ready(function(a){function q(b,c){u=!0;var d=a("#"+b);if(x||a(".icons .speaker",d).hasClass("active")||!p){var e=a("div#sb_messages",d);if(!d.data("lock")||c){var n=b.substring(b.lastIndexOf("-")+1);a(".icons .warning",d).hide();a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_refresh",m:a(d).data("msgTotal"),id:n},beforeSend:function(){a(".icons .spinner",d).css("display","inline-block")},error:function(){a(".icons .spinner",d).hide();a(".icons .warning",d).show()},success:function(b){if(u){var c=e.hasClass("reverse-order"),n=e[0].scrollHeight-e[0].scrollTop-e[0].offsetHeight;e.hasClass("empty")&&(r=!0);e.after('<div style="display:none" id="msgs_placeholder"></div>');var y=a("#msgs_placeholder",d);y.html(b);b=y.children().last();for(var g=c?e.children().first():e.children().last(),m,v,f,h,k=!1;0<b.length;){if(v=b.attr("id")){for(f=v.substring(v.lastIndexOf("_")+1);0<g.length;){if(m=g.attr("id"))if(h=m.substring(m.lastIndexOf("_")+1),f<=h)break;m=g;g=c?g.next():g.prev();m.slideUp(function(){a(this).remove()})}f==h?(b.attr("hash")!=g.attr("hash")&&g.html(b.html()),g=c?g.next():g.prev()):(0==g.length?(c?e.append(b[0].outerHTML):e.prepend(b.hide()[0].outerHTML).children().first().slideDown(),k=!0):c?g.before(b[0].outerHTML):g.after(b[0].outerHTML),z("div#sb_messages #sb_message_"+f+" .sb_message_body > a > img"),A(f))}b=b.prev()}for(;0<g.length;)m=g,g=c?g.next():g.prev(),(m.attr("id")||v)&&m.slideUp(function(){a(this).remove()});y.remove();a(".icons .speaker",d);k&&a(".icons .speaker",d).hasClass("active")&&a("audio#notify",d)[0].play();c&&(e.hasClass("empty")||k&&0==n?setTimeout(function(){e.animate({scrollTop:e[0].scrollHeight},"slow",function(){r=!1})},1E3):e[0].scrollTop!=e[0].scrollHeight-e[0].offsetHeight-n&&(e[0].scrollTop=e[0].scrollHeight-e[0].offsetHeight-n));e.hasClass("empty")&&e.removeClass("empty")}a(".icons .spinner",d).fadeOut("slow")},complete:function(){a(d).data("msgAddLock",0);u=!1}})}}else clearInterval(p),p=0}function z(b){void 0===b&&(b=".sb_message_body > a > img");try{"function"==typeof a.fn.lightbox?a(b).parent().attr("rel","lightbox").lightbox({title:function(){return a(this).children().attr("alt")}}):a.colorbox?a(b).parent().colorbox({title:function(){return a(this).children().attr("alt")},maxWidth:"100%",maxHeight:a(window).height()-2*(a("#wpadminbar").height()||0)}):"function"==typeof a.fn.fancybox?a(b).parent().fancybox({title:function(){return a(this).children().attr("alt")}}):"undefined"!==typeof Shadowbox?Shadowbox.setup(a(b).parent().get(),[]):"function"==typeof doLightBox&&(a(b).parent().attr("rel","lightbox"),doLightBox())}catch(c){}}function B(b,c,d,e,n){b.preventDefault();b=e+a(c).attr("rel")+"?autoplay=1";e=a(window).width();var l=a(window).height(),f=16/9;640<=e?e/f>l?(e*=.9,l=e/f):(l*=.9,e=l*f):l=e/f;a.colorbox?a.colorbox({width:e+44,height:l+70,iframe:!0,href:b}):"function"==typeof a.fn.fancybox?a(c).addClass("iframe").attr("href",b).fancybox().click():"undefined"!==typeof Shadowbox?Shadowbox.open({content:b,type:"iframe",player:"iframe",width:e,height:l}):320>a(c).parents("."+d+"-embed-video").width()?window.open(b,n,"width=640,height=360"):a(c).parents("."+d+"-embed-video").replaceWith('<iframe width="100%" height="'+360*a(c).parents("."+d+"-embed-video").width()/640+'" src="'+b+'"></iframe>')}function h(a){var c={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;"hidden"==(a.type in c?c[a.type]:this[k]?"hidden":"visible")?x=!1:(x=!0,p||(p=setInterval(function(){q(w)},C),q(w)))}function E(a,c){if(document.selection)a.focus(),sel=document.selection.createRange(),sel.text=c;else if(a.selectionStart||"0"==a.selectionStart){var d=a.selectionEnd;a.value=a.value.substring(0,a.selectionStart)+c+a.value.substring(d,a.value.length)}else a.value+=c}function A(b){var c=".sb_message_header .menu";b&&(c="#sb_message_"+b+" "+c);a(c).each(function(){a(this).append('<span class="commands"></span><span class="infos"></span>');a(this).find(".command").appendTo(a(this).find(".commands"));a(this).find(".info").appendTo(a(this).find(".infos"))})}function F(){D=!1;f=0;a("#sb-reply").hide()}var t="placeholder"in document.createElement("input");SimpleAjaxShoutbox=a.extend({},{ajaxurl:window.location.origin+"/wp-admin/admin-ajax.php",reload_time:"30",max_messages:"20",max_msglen:"255",request_error_text:"Request error",max_msglen_error_text:"Max length of message is %maxlength% characters, length of your message is %length% characters. Please shorten it.",name_empty_error_text:"Name empty.",msg_empty_error_text:"Message empty.",delete_message_text:"Delete this message?"},SimpleAjaxShoutbox);var x=!0,r=!1,u=!1;a("body").on("click",".sb_message_header .menu .delete",function(b){b.preventDefault();var c=a(this).parents(".Ajax_Shoutbox_Widget");b=a(this).parents(".sb_message").attr("id");b=b.substring(b.lastIndexOf("_")+1);if(!confirm(SimpleAjaxShoutbox.delete_message_text))return!1;a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_delete_message",m_id:b,_ajax_nonce:a("data#nonce",c).attr("value")},success:function(b,e){0<parseInt(b)&&a("div#sb_message_"+b,c).slideUp("slow",function(){a(this).remove()});a("#sb_message",c).val("")}})});z();var p=0,w,C;a(".Ajax_Shoutbox_Widget").each(function(b){function c(b){u=!1;b&&b.preventDefault();var c=a("#"+d);b=parseInt(SimpleAjaxShoutbox.max_msglen);if(a("#sb_message",c).val().length>b)b=SimpleAjaxShoutbox.max_msglen_error_text.replace("%length%",a("#sb_message").val().length).replace("%maxlength%",b),alert(b);else{t||c.parents("form").find("[placeholder]").each(function(){var b=a(this);b.val()==b.attr("placeholder")&&b.val("")});b=a("input#sb_name",c).val();var f=a("input#sb_website",c).val(),h=a("#sb_message",c).val();if(""==b)alert(SimpleAjaxShoutbox.name_empty_error_text),t||a("#sb_form [placeholder]",c).blur();else if(""==h)alert(SimpleAjaxShoutbox.msg_empty_error_text),t||a("#sb_form [placeholder]",c).blur();else{a("#sb_form .spinner",c).css("display","inline-block");a("#sb_addmessage",c).addClass("disabled");var k=d.substring(d.lastIndexOf("-")+1);a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_add_message",user:b,message:h,website:f,id:k},success:function(b){var e=b.match(/sb_message_(\d+)/);if(0==a("div#sb_messages #sb_message_"+e[1],c).length){var d=a("div#sb_messages",c),f=a("div.no-messages",d);f.length&&f.remove();d.hasClass("reverse-order")?(f=d[0].scrollHeight-d[0].scrollTop-d[0].offsetHeight,d.append(b),0==f&&(r=!0,d.animate({scrollTop:d[0].scrollHeight},"fast",function(){r=!1}))):(b=b.replace('id="sb_message_','style="display:none" id="sb_message_'),d.prepend(b),a("#sb_message_"+e[1],d).slideDown());z("#sb_message_"+e[1]+" .sb_message_body > a > img");A(e[1])}a("#sb_message",c).val("");t||a("#sb_form [placeholder]",c).blur();a("#sb_form .spinner",c).hide();a("#sb_form .confirm",c).css("display","inline-block").fadeOut("slow")},error:function(b){a("#sb_form .spinner",c).hide()},complete:function(){a("#sb_addmessage",c).removeClass("disabled")}})}}}var d=a(this).data("lock",0).data("msgAddLock",0).data("msgTotal",SimpleAjaxShoutbox.max_messages).attr("id");w=d;C=1E3*parseInt(SimpleAjaxShoutbox.reload_time);p=setInterval(function(){q(w)},C);a("#sb_smiles .wp-smiley",this).click(function(b){b=a(this).parents(".Ajax_Shoutbox_Widget").find("#sb_form #sb_message")[0];E(b,a(this).attr("title"));b.focus()});a("div#sb_messages",this).scroll(function(){var b=a(this);if(!(r||b.hasClass("reverse-order")&&b.hasClass("empty"))){var c=a("#"+d),f=b.hasClass("reverse-order")?b[0].scrollHeight-b.scrollTop()>b.outerHeight():5<b.scrollTop();c.data("lock",f);a(".icons .lock",c).toggle(f);!c.data("msgAddLock")&&(b.hasClass("reverse-order")?0==b.scrollTop():b[0].scrollHeight-b.scrollTop()<=b.outerHeight())&&(c.data("msgAddLock",1).data("msgTotal",parseInt(c.data("msgTotal"))+parseInt(SimpleAjaxShoutbox.max_messages)),q(d,!0))}});a("#sb_addmessage",this).click(c);a("#sb_message",this).keydown(function(a){10!=a.keyCode&&13!=a.keyCode||!a.ctrlKey||c()});q(d)});a("div#sb_messages").mouseover(function(){a("span#sb_status").html("")});a("#sb_showsmiles").click(function(){a("div#sb_smiles").fadeIn("slow")});a(".Ajax_Shoutbox_Widget .icons .speaker").click(function(){document.cookie="shoutbox_speaker="+(a(this).toggleClass("active").hasClass("active")?"true":"false")+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"});t||(a("#sb_form [placeholder]").focus(function(){var b=a(this);b.val()==b.attr("placeholder")&&(b.val(""),b.removeClass("sb_placeholder"))}).blur(function(){var b=a(this);if(""==b.val()||b.val()==b.attr("placeholder"))b.addClass("sb_placeholder"),b.val(b.attr("placeholder"))}).blur(),a("#sb_form [placeholder]").parents("form").submit(function(){a(this).find("[placeholder]").each(function(){var b=a(this);b.val()==b.attr("placeholder")&&b.val("")})}));a("body").on("click",".sb_message_body .youtube-embed-video .play-button",function(a){B(a,this,"youtube","https://www.youtube.com/embed/","YouTube")});a("body").on("click",".sb_message_body .vidme-embed-video .play-button",function(a){B(a,this,"vidme","https://vid.me/e/","vid.me")});a("body").on("click",".sb_message_body .vimeo-embed-video .play-button",function(a){B(a,this,"vimeo","https://player.vimeo.com/video/","vimeo")});var k="hidden";k in document?document.addEventListener("visibilitychange",h):(k="mozHidden")in document?document.addEventListener("mozvisibilitychange",h):(k="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",h):(k="msHidden")in document?document.addEventListener("msvisibilitychange",h):"onfocusin"in document?document.onfocusin=document.onfocusout=h:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=h;void 0!==document[k]&&h({type:document[k]?"blur":"focus"});A();a("body").on("click",".sb_message_header .menu .reply",function(b){b.preventDefault();b=a(this).parents(".sb_message").attr("id").substring(11);a(this).parents(".sb_message").find(".username").text();b="{reply "+b+"} ";var c=a(this).parents(".Ajax_Shoutbox_Widget").find("#sb_form #sb_message")[0];E(c,b);c.focus()});a("body").append('<div id="sb-reply">Reply</div>');var D=!1,f=0;a("body").on("mouseenter",".sb_message_body .reply",function(b){f&&(clearTimeout(f),f=0);var c=a(this).parents(".Ajax_Shoutbox_Widget");b=c.attr("id");b=b.substring(b.lastIndexOf("-")+1);var d=a(this).offset().top+a(this).height(),e=a(this).parents(".sb_message_body").offset().left,h=a(this).parents(".sb_message_body").width(),l=a(this).attr("rel"),k=c.find("#sb_message_"+l);D=!0;a("#sb-reply").attr("rel")==l?a("#sb-reply").css("top",d).css("left",e).css("width",h).show():0<k.length?a("#sb-reply").html(k.html()).attr("rel",l).css("top",d).css("left",e).css("width",h).show():a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_single",m_id:l,id:b},beforeSend:function(){a(".icons .spinner",c).css("display","inline-block")},success:function(b,c){""!=b&&a("#sb-reply").html(b).attr("rel",l).css("top",d).css("left",e).css("width",h);D&&a("#sb-reply").show()},complete:function(){a(".icons .spinner",c).fadeOut("slow")}})}).on("mouseleave",".sb_message_body .reply",function(a){f=setTimeout(function(){F()},100)});a("body").on("mouseenter","#sb-reply",function(a){f&&(clearTimeout(f),f=0)}).on("mouseleave","#sb-reply",function(a){F()});a("#sb_form .resizable").resizable({handles:"s",minHeight:36,stop:function(b,c){var d=a(this),e=this.offsetHeight/parseFloat(d.css("font-size"))+"em";d.css("height",e);document.cookie=d.parents(".Ajax_Shoutbox_Widget").attr("id")+"_input_height="+e+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"}})});